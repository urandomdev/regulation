-- Code generated by ent, DO NOT EDIT.
-- atlas:pos accounts[type=table] /home/delta/projects/regulation/api/internal/ent/schema/account.go:15
-- atlas:pos items[type=table] /home/delta/projects/regulation/api/internal/ent/schema/item.go:15
-- atlas:pos push_subscriptions[type=table] /home/delta/projects/regulation/api/internal/ent/schema/push_subscription.go:15
-- atlas:pos sync_cursors[type=table] /home/delta/projects/regulation/api/internal/ent/schema/sync_cursor.go:15
-- atlas:pos transactions[type=table] /home/delta/projects/regulation/api/internal/ent/schema/transaction.go:15
-- atlas:pos users[type=table] /home/delta/projects/regulation/api/internal/ent/schema/user.go:11

-- Create "users" table
CREATE TABLE "users" (
  "id" uuid NOT NULL,
  "email" character varying NOT NULL,
  "password" bytea NOT NULL,
  "nickname" character varying NOT NULL,
  "custody_account_id" uuid NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "users_users_custody_account" FOREIGN KEY ("custody_account_id") REFERENCES "users" ("id") ON DELETE SET NULL
);
-- Create index "users_email_key" to table: "users"
CREATE UNIQUE INDEX "users_email_key" ON "users" ("email");
-- Create "items" table
CREATE TABLE "items" (
  "id" uuid NOT NULL,
  "plaid_id" character varying NOT NULL,
  "access_token" character varying NOT NULL,
  "institution_name" character varying NOT NULL,
  "is_active" boolean NOT NULL DEFAULT true,
  "created_at" timestamptz NOT NULL,
  "updated_at" timestamptz NOT NULL,
  "user_id" uuid NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "items_users_items" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON DELETE NO ACTION
);
-- Create index "items_plaid_id_key" to table: "items"
CREATE UNIQUE INDEX "items_plaid_id_key" ON "items" ("plaid_id");
-- Create index "item_user_id_is_active" to table: "items"
CREATE INDEX "item_user_id_is_active" ON "items" ("user_id", "is_active");
-- Create index "item_plaid_id" to table: "items"
CREATE UNIQUE INDEX "item_plaid_id" ON "items" ("plaid_id");
-- Create "accounts" table
CREATE TABLE "accounts" (
  "id" uuid NOT NULL,
  "plaid_id" character varying NOT NULL,
  "name" character varying NOT NULL,
  "type" character varying NOT NULL DEFAULT 'checking',
  "subtype" character varying NULL,
  "mask" character varying NULL,
  "current_balance" bigint NOT NULL DEFAULT 0,
  "available_balance" bigint NULL,
  "is_active" boolean NOT NULL DEFAULT true,
  "created_at" timestamptz NOT NULL,
  "updated_at" timestamptz NOT NULL,
  "item_id" uuid NOT NULL,
  "user_id" uuid NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "accounts_items_accounts" FOREIGN KEY ("item_id") REFERENCES "items" ("id") ON DELETE NO ACTION,
  CONSTRAINT "accounts_users_accounts" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON DELETE NO ACTION
);
-- Create index "accounts_plaid_id_key" to table: "accounts"
CREATE UNIQUE INDEX "accounts_plaid_id_key" ON "accounts" ("plaid_id");
-- Create index "account_user_id_is_active" to table: "accounts"
CREATE INDEX "account_user_id_is_active" ON "accounts" ("user_id", "is_active");
-- Create index "account_plaid_id" to table: "accounts"
CREATE UNIQUE INDEX "account_plaid_id" ON "accounts" ("plaid_id");
-- Create index "account_item_id" to table: "accounts"
CREATE INDEX "account_item_id" ON "accounts" ("item_id");
-- Create "push_subscriptions" table
CREATE TABLE "push_subscriptions" (
  "id" uuid NOT NULL,
  "endpoint" character varying NOT NULL,
  "p256dh" character varying NOT NULL,
  "auth" character varying NOT NULL,
  "active" boolean NOT NULL DEFAULT true,
  "created_at" timestamptz NOT NULL,
  "updated_at" timestamptz NOT NULL,
  "user_id" uuid NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "push_subscriptions_users_push_subscriptions" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON DELETE NO ACTION
);
-- Create index "pushsubscription_user_id_active" to table: "push_subscriptions"
CREATE INDEX "pushsubscription_user_id_active" ON "push_subscriptions" ("user_id", "active");
-- Create index "pushsubscription_endpoint" to table: "push_subscriptions"
CREATE UNIQUE INDEX "pushsubscription_endpoint" ON "push_subscriptions" ("endpoint");
-- Create "sync_cursors" table
CREATE TABLE "sync_cursors" (
  "id" uuid NOT NULL,
  "cursor" character varying NOT NULL DEFAULT '',
  "last_sync_at" timestamptz NOT NULL,
  "item_id" uuid NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "sync_cursors_items_sync_cursor" FOREIGN KEY ("item_id") REFERENCES "items" ("id") ON DELETE NO ACTION
);
-- Create index "sync_cursors_item_id_key" to table: "sync_cursors"
CREATE UNIQUE INDEX "sync_cursors_item_id_key" ON "sync_cursors" ("item_id");
-- Create index "synccursor_item_id" to table: "sync_cursors"
CREATE UNIQUE INDEX "synccursor_item_id" ON "sync_cursors" ("item_id");
-- Create "transactions" table
CREATE TABLE "transactions" (
  "id" uuid NOT NULL,
  "plaid_id" character varying NOT NULL,
  "amount" bigint NOT NULL,
  "date" timestamptz NOT NULL,
  "name" character varying NOT NULL,
  "merchant_name" character varying NULL,
  "category" character varying NOT NULL DEFAULT 'Misc',
  "plaid_categories" jsonb NULL,
  "pending" boolean NOT NULL DEFAULT false,
  "payment_channel" character varying NULL,
  "created_at" timestamptz NOT NULL,
  "updated_at" timestamptz NOT NULL,
  "account_id" uuid NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "transactions_accounts_transactions" FOREIGN KEY ("account_id") REFERENCES "accounts" ("id") ON DELETE NO ACTION
);
-- Create index "transactions_plaid_id_key" to table: "transactions"
CREATE UNIQUE INDEX "transactions_plaid_id_key" ON "transactions" ("plaid_id");
-- Create index "transaction_account_id_date" to table: "transactions"
CREATE INDEX "transaction_account_id_date" ON "transactions" ("account_id", "date");
-- Create index "transaction_plaid_id" to table: "transactions"
CREATE UNIQUE INDEX "transaction_plaid_id" ON "transactions" ("plaid_id");
-- Create index "transaction_category" to table: "transactions"
CREATE INDEX "transaction_category" ON "transactions" ("category");
-- Create index "transaction_pending" to table: "transactions"
CREATE INDEX "transaction_pending" ON "transactions" ("pending");

